<!doctype html>
<html>
  <head>
    <title>Faceclick</title>
    <style>
      body {
        font-family: Arial;
      }
      .profile {
        width:200px;
        height:200px;
        background-color:#eee;
        text-align: center;
        border-radius: 5px;
        border:2px solid #ccc;
      }

      .profile img {
        border-radius:40px;
      }
    </style>
  </head>
  <body>

  <div id="login">
    <input type="text" id="username" placeholder="username">
    <button id="save">Save</button>
  </div>


  <script src="/socket.io/socket.io.js"></script>
  <script src="/jquery-1.11.1.js"></script>
  <script src="/md5.js"></script>
  <script>
    var socket   = io();
    var user     = {};

    var messages = $("#messages");
    var body     = $("body");
    var message  = $("#message");

    var save     = $("#save");
    var username = $("#username");
    var login    = $("#login");
    var profile  = $("<div></div>").attr("class", "profile").css({
      "background-color": "#eee",
      "width": 200,
      "height": 200
    });

    save.click(function() {
      var u               = username.val();
      var usernameHash    = CryptoJS.MD5(u);
      var profile_picture = "https://www.gravatar.com/avatar/" + usernameHash + "?d=monsterid"
      var input = {
        "username": u,
        "profile_picture": profile_picture
      };
      if(validateUsername(input.username)) {
        socket.emit('set username and profile picture', input);
        socket.username        = input.username;
        socket.profile_picture = input.profile_picture;
        login.hide();
        profile.append("<h1>" + input.username + "</h1>");
        profile.append('<img src="' + input.profile_picture + '"/>');
        profile.append('<br>');
        profile.append('<button>Ready</button>');
        body.prepend(profile);
      } else {
        alert("Username invalid!");
      }
    });






































    // var div      = $("<div> </div>").attr("id", "color").css({
    //   "display":   "none",
    //   "height":    "100%",
    //   "width":     "100%",
    //   "position":   "absolute",
    //   "z-index":    10
    // });
    // body.prepend(div);

    // $("form").submit(function() {
    //   var input = {
    //     "message": message.val(),
    //     "username": user.username
    //   };
    //   message_all(input);
    //   return false;
    // });

    // socket.on('show_color', function(input){
    //   console.log(input);
    //   div.css("background-color", input.color);
    //   div.show();
    // });

    // socket.on('hide_color', function(){
    //   div.hide();
    // });

    // socket.on('message_all', function(input){
    //   console.log(input);
    //   messages.append($("<li>").text(input.message));
    // });

    // socket.on('connect', function() {
    //   connected();
    // });

    // function message_all(input) {
    //   socket.emit('message_all', input);
    //   message.val("");
    //   input.message = "";
    // }

    // function connected() {
    //   var username;
    //   while(!validateUsername(username)) {
    //     username = prompt("What's your username?");
    //   }
    //   user["username"] = username;
    //   socket.emit('new_user_connected', user);
    // }

    function validateUsername(username){
      if(username != null) {
        var usernameRegex = /^[a-zA-Z0-9]+$/;
        var validfirstUsername = username.match(usernameRegex);
        if(validfirstUsername != null) {
          return true;
        } else {
          return false;
        }
      } else {
        return false;
      }
    }
  </script>
  </body>
</html>
